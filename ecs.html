<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Blank Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * {
            font-family: monospace;
        }

        body {
            background-color: black;
            color: darkgray;
        }

        canvas {
            border: 1px solid darkgray;
        }

        #title {
            padding-bottom: 10px;
            font-size: 18px;
        }

        #buttons {
            padding-top: 10px;
        }
    </style>
</head>

<body>
    <div id="title">
        <span>Blank Game</span>
    </div>
    <div>
        <canvas id="canvas" width="1536" height="864"></canvas>
    </div>
    <div id="buttons">
        <button onclick="">Pause/Resume</button>
    </div>
    <script src="code/particles.js"></script>
    <script src="code/sound.js"></script>
    <script src="code/loop.js"></script>
    <script src="code/basic.js"></script>
    <script src="code/ecs.js"></script>
    <script>
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");

        class Scene {
            constructor() {
                this.width = canvas.width;
                this.height = canvas.height;
                this.entities = [];
                this.particleSystem = new ParticleSystem();
                this.movementSystem = new MovementSystem();
                this.collisionDetectionSystem = new CollisionDetectionSystem();
                this.collisionHandlingSystem = new CollisionHandlingSystem();
                this.soundManager = new SoundManager();
            }
        }

        function update(delta) {
            scene.movementSystem.update(delta, scene.entities);
            scene.collisionDetectionSystem.update(delta, scene.entities);
            scene.collisionHandlingSystem.update(delta, scene.entities);
            scene.particleSystem.update(delta);
        }

        function draw(interp) {
            ctx.clearRect(0, 0, scene.width, scene.height);
            ctx.save();

            // Entities
            for (var i = 0; i < scene.entities.length; i++) {
                var entity = scene.entities[i];
                if (entity.hasComponent("Transform")) {
                    //ctx.fillStyle = new Color(0, 0, 100, 1).style;
                    ctx.fillStyle = "#" + entity.id.substring(0, 6);
                    ctx.font = "12px monospace";
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    //ctx.fillText("{" + transform.position.x.toFixed(0) + "," + transform.position.y.toFixed(0) + "}", transform.position.x, transform.position.y);
                    ctx.fillText(entity.id.substring(0, 6), entity.transform.position.x.toFixed(0), entity.transform.position.y.toFixed(0));
                }
            }

            // FPS
            ctx.fillStyle = new Color(0, 0, 100, 0.5).style;
            ctx.font = "12px monospace";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(Math.round(loop.getFPS()) + " FPS", scene.width - 55, 35);

            ctx.restore();
        }

        var scene = new Scene();
        var loop = new Loop().setUpdate(update).setDraw(draw).start();

        for (var i = 0; i < 50; i++) {
            var entity = new Entity();
            var transform = new TransformComponent();
            transform.position = new Vector(Random.int(0, scene.width), Random.int(0, scene.height));
            entity.addComponent(transform);
            if (Random.float(0, 1) < 0.8) {
                var motion = new MotionComponent();
                motion.acceleration = new Vector(Random.float(-0.001, 0.001), Random.float(-0.001, 0.001));
                motion.maxVelocity = Random.float(0.1, 0.3);
                entity.addComponent(motion);
            }
            var collision = new CollisionDetectionComponent();
            collision.boundingBox = new Vector(3, 3);
            entity.addComponent(collision);
            scene.entities.push(entity);
        }

        var topWall = new Entity();
        var topWallTransform = new TransformComponent();
        topWallTransform.position = new Vector(scene.width / 2, 5);
        topWall.addComponent(topWallTransform);
        var topWallCollision = new CollisionDetectionComponent();
        topWallCollision.boundingBox = new Vector(scene.width / 2, 1);
        topWall.addComponent(topWallCollision);
        scene.entities.push(topWall);

        var bottomWall = new Entity();
        var bottomWallTransform = new TransformComponent();
        bottomWallTransform.position = new Vector(scene.width / 2, scene.height - 5);
        bottomWall.addComponent(bottomWallTransform);
        var bottomWallCollision = new CollisionDetectionComponent();
        bottomWallCollision.boundingBox = new Vector(scene.width / 2, 1);
        bottomWall.addComponent(bottomWallCollision);
        scene.entities.push(bottomWall);

        var leftWall = new Entity();
        var leftWallTransform = new TransformComponent();
        leftWallTransform.position = new Vector(5, scene.height / 2);
        leftWall.addComponent(leftWallTransform);
        var leftWallCollision = new CollisionDetectionComponent();
        leftWallCollision.boundingBox = new Vector(1, scene.height / 2);
        leftWall.addComponent(leftWallCollision);
        scene.entities.push(leftWall);

        var rightWall = new Entity();
        var rightWallTransform = new TransformComponent();
        rightWallTransform.position = new Vector(scene.width - 5, scene.height / 2);
        rightWall.addComponent(rightWallTransform);
        var rightWallCollision = new CollisionDetectionComponent();
        rightWallCollision.boundingBox = new Vector(1, scene.height / 2);
        rightWall.addComponent(rightWallCollision);
        scene.entities.push(rightWall);

        scene.soundManager.sequencer.start();

    </script>
</body>

</html>